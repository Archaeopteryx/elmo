{% extends "base.html" %}
{% block title_matter %}Bugs for a new localization{% endblock %}
{% block head_matter %}
<style type="text/css">
#account {
  position:fixed;
  bottom:0;
  right:0;
  width:300px;
  height:100px;
  border:1px solid black
}
</style>
<script type="text/javascript" src="{% url static path="jquery.js" %}"></script>
<script type="application/javascript">
var apibase = 'https://api-dev.bugzilla.mozilla.org/0.4/';

function getBugURL(params) {
  var ps = [];
  for (var k in params) {
    if (k != 'title') {
      ps.push(k + '=' + encodeURIComponent(params[k]));
    }
  }
  var url = 'https://bugzilla.mozilla.org/enter_bug.cgi?';
  url += ps.join('&');
  return url;
};

function doBugs() {
  var params = {};
  function addParam() {
    params[this.name] = this.value;
  }
  $.each(document.forms.bugdata.elements, addParam);
  function handleLinkJSON(data, result) {
    var out = $("#links");
    if (result != "success") {
      out.html("Failed to create bug links");
      return;
    }
    out.html('');
    $.each(data, function() {
      var child = $('<a>').text(this.title);
      child.attr('href',  getBugURL(this));
      child.attr('target',  '_blank');
      out.append(child);
      out.append(" ");
    })
  }
  $.getJSON("{% url bugsy.views.new_locale_bugs %}", params, handleLinkJSON);
}
</script>
{% endblock %}
{% block content %}
<h1>File bugs for a new localization</h1>
<form name="bugdata">
<table>
  <tr>
    <td>Locale:</td>
    <td><input name="loc" value=""></td>
  </tr>
  <tr>
    <td>Language:</td>
    <td><input name="language" value=""></td>
  </tr>
  <tr>
    <td>Component:</td>
    <td><input name="component" value="Other"></td>
  </tr>
  <tr>
    <td>Name:</td>
    <td><input name="name" value=""></td>
  </tr>
  <tr>
    <td>Bugzilla ID:</td>
    <td><input name="bugmail" value=""></td>
  </tr>
  <tr>
    <td>Version:</td>
    <td><input name="version" value="3.6"></td>
  </tr>
</table>
</form>
<p>
<input type="button" onclick="return doBugs()"
                value="Create Buglinks">
</p>
<p id="links"></p>

<iframe id="account"
        style="position:absolute;bottom:0;right:0;width:300px;height:100px;border:1px solid black"
        src="{% url accounts.views.index %}">
</iframe>
{% endblock %}
